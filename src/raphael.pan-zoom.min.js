/***
 * raphael.pan-zoom plugin 0.2.1
 * Copyright (c) 2012 @author Juan S. Escobar
 * https://github.com/escobar5
 *
 * licensed under the MIT license
 */
!function(){"use strict";function o(o){for(var e,t=o.offsetLeft,n=o.offsetTop;o.offsetParent&&o!==document.getElementsByTagName("body")[0];)t+=o.offsetParent.offsetLeft,n+=o.offsetParent.offsetTop,o=o.offsetParent;return e=[t,n]}function e(e,t){var n,r,i;return!e.pageX&&!e.pageY||e.touches?(n=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,r=e.clientY+document.body.scrollTop+document.documentElement.scrollTop):(n=e.pageX,r=e.pageY),i=o(t),n-=i[0],r-=i[1],{x:n,y:r}}var t=function(){},n={enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},zoomIn:function(o){this.applyZoom(o)},zoomOut:function(o){this.applyZoom(o>0?-1*o:o)},pan:function(o,e){this.applyPan(-1*o,-1*e)},isDragging:function(){return this.dragTime>this.dragThreshold},getCurrentPosition:function(){return this.currPos},getCurrentZoom:function(){return this.currZoom},onZoomChange:function(o){t=o}},r=function(o,n){function r(){m.currPos.x=m.currPos.x+g,m.currPos.y=m.currPos.y+d;var o=s.width*(1-m.currZoom*l.zoomStep),e=s.height*(1-m.currZoom*l.zoomStep);m.currPos.x<0?m.currPos.x=0:m.currPos.x>s.width*m.currZoom*l.zoomStep&&(m.currPos.x=s.width*m.currZoom*l.zoomStep),m.currPos.y<0?m.currPos.y=0:m.currPos.y>s.height*m.currZoom*l.zoomStep&&(m.currPos.y=s.height*m.currZoom*l.zoomStep),s.setViewBox(m.currPos.x,m.currPos.y,o,e)}function i(o){if(!m.enabled)return!1;var t=window.event||o,n=s.width*(1-m.currZoom*l.zoomStep),i=s.height*(1-m.currZoom*l.zoomStep),u=e(t,h);return g=n*(u.x-p.x)/s.width*-1,d=i*(u.y-p.y)/s.height*-1,p=u,r(),m.dragTime+=1,t.preventDefault?t.preventDefault():t.returnValue=!1,!1}function u(o,e){return m.enabled?(m.currZoom+=o,void(m.currZoom<l.minZoom?m.currZoom=l.minZoom:m.currZoom>l.maxZoom?m.currZoom=l.maxZoom:(e=e||{x:s.width/2,y:s.height/2},g=s.width*l.zoomStep*(e.x/s.width)*o,d=s.height*l.zoomStep*(e.y/s.height)*o,r(),t(m.currZoom)))):!1}function a(o){if(!m.enabled)return!1;var t=window.event||o,n=t.detail||-1*t.wheelDelta,r=e(t,h);return n>0?n=-1:0>n&&(n=1),u(n,r),t.preventDefault?t.preventDefault():t.returnValue=!1,!1}function c(o,e){g=o,d=e,r()}var s=o,h=s.canvas.parentNode,m=this,l={},p={x:0,y:0},g=0,d=0,f=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll MozMousePixelScrollZ":"mousewheel";this.enabled=!1,this.dragThreshold=5,this.dragTime=0,n=n||{},l.maxZoom=n.maxZoom||9,l.minZoom=n.minZoom||0,l.zoomStep=n.zoomStep||.1,l.initialZoom=n.initialZoom||0,l.initialPosition=n.initialPosition||{x:0,y:0},this.currZoom=l.initialZoom,this.currPos=l.initialPosition,this.applyZoom=u,r(),h.onmousedown=function(o){var t=window.event||o;return m.enabled?(m.dragTime=0,p=e(t,h),h.className+=" grabbing",h.onmousemove=i,document.onmousemove=function(){return!1},t.preventDefault?t.preventDefault():t.returnValue=!1,!1):!1},h.onmouseup=function(o){document.onmousemove=null,h.className=h.className.replace(/(?:^|\s)grabbing(?!\S)/g,""),h.onmousemove=null},h.attachEvent?h.attachEvent("on"+f,a):h.addEventListener&&f.split(" ").forEach(function(o){h.addEventListener(o,a,!1)});var v=0,Z=0;$(h).bind("touchstart",function(o){m.dragThreshold=2,0==Z?Z=1:1==Z&&(Z=2);var e=o.originalEvent||o;return e.clientX=e.changedTouches[0].pageX,e.clientY=e.changedTouches[0].pageY,e.touches.length>1?void(v=Math.sqrt(Math.pow(e.touches[0].pageX-e.touches[1].pageX,2)+Math.pow(e.touches[0].pageY-e.touches[1].pageY,2))):void h.onmousedown(e)}),$(h).bind("touchend",function(o){var e=o.originalEvent||o;e.clientX=e.changedTouches[0].pageX,e.clientY=e.changedTouches[0].pageY,e.touches.length>1||(h.onmouseup(e),1!=Z||m.isDragging()||$(e.target).click(),Z=0)}),$(h).bind("touchmove",function(o){var e=o.originalEvent||o;if(e.clientX=e.changedTouches[0].pageX,e.clientY=e.changedTouches[0].pageY,e.touches.length>1){var t=Math.sqrt(Math.pow(e.touches[0].pageX-e.touches[1].pageX,2)+Math.pow(e.touches[0].pageY-e.touches[1].pageY,2));return e.wheelDelta=360*(t/v-1)*3,v=t,e.clientX=(e.touches[0].pageX+e.touches[1].pageX)/2,e.clientY=(e.touches[0].pageY+e.touches[1].pageY)/2,void a(e)}i(e)}),this.applyPan=c};r.prototype=n,Raphael.fn.panzoom={},Raphael.fn.panzoom=function(o){var e=this;return new r(e,o)}}();